datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  ADMIN
  SINDICO
  PORTEIRO
  MORADOR
}

enum PackageType {
  DELIVERY
  ENCOMENDA
}

enum VisitStatus {
  AGENDADA
  EM_ANDAMENTO
  FINALIZADA
  CANCELADA
}

model User {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  password      String
  role          UserRole
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  condominiumId Int

  packages    Package[]
  visits      Visit[]
  residents   Resident[]
  condominium Condominium @relation(fields: [condominiumId], references: [id])
}

model Package {
  id          Int         @id @default(autoincrement())
  type        PackageType
  receiveCode String?
  description String
  receivedAt  DateTime    @default(now())
  userId      Int
  user        User        @relation(fields: [userId], references: [id])
}

model Visit {
  id           Int         @id @default(autoincrement())
  visitorName  String
  vehiclePlate String?
  status       VisitStatus @default(AGENDADA)
  scheduledAt  DateTime
  userId       Int
  user         User        @relation(fields: [userId], references: [id])
}

model Condominium {
  id        Int      @id @default(autoincrement())
  name      String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  apartments Apartment[]

  users User[]
}

model Apartment {
  id            Int         @id @default(autoincrement())
  number        String
  residentName  String
  condominiumId Int
  condominium   Condominium @relation(fields: [condominiumId], references: [id])

  residents Resident[]
}

model Resident {
  id          Int       @id @default(autoincrement())
  userId      Int
  apartmentId Int
  user        User      @relation(fields: [userId], references: [id])
  apartment   Apartment @relation(fields: [apartmentId], references: [id])

  @@unique([userId, apartmentId])
}
